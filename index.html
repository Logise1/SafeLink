<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoopChat</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366F1"/>
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LoopChat">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuente Inter de Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --brand-color: #6366F1; /* Indigo-500 */
            --brand-color-light: #E0E7FF; /* Indigo-100 */
            --brand-color-dark: #4338CA; /* Indigo-700 */
        }
        html, body {
            height: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        body { 
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #f3e8ff, #dbeafe);
        }
        .screen { display: none; }
        .active-screen { display: flex; }

        .app-container {
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            background-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center">

    <div class="app-container w-full max-w-md mx-auto md:rounded-2xl shadow-lg flex flex-col">
        
        <!-- Pantalla de Carga -->
        <div id="loading-screen" class="screen active-screen flex-1 flex-col items-center justify-center p-6 md:p-8">
             <svg class="animate-spin h-10 w-10 text-[var(--brand-color)]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-gray-600 font-medium">Cargando LoopChat...</p>
        </div>

        <!-- Pantalla de Bienvenida y Registro Unificada -->
        <div id="welcome-screen" class="screen flex-1 flex-col items-center justify-center text-center p-6 md:p-8">
            <div id="welcome-main" class="w-full">
                <div class="bg-[var(--brand-color-light)] p-4 rounded-full mb-4 inline-block">
                    <svg class="w-10 h-10 text-[var(--brand-color)]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-900">Bienvenido a LoopChat</h1>
                <p class="text-gray-500 mt-2 mb-8">Un espacio seguro para que los niños conecten.</p>
                <button id="show-parent-onboarding" class="w-full bg-[var(--brand-color)] text-white font-bold py-3 px-4 rounded-xl hover:bg-[var(--brand-color-dark)] transition duration-300 shadow-sm">Soy Padre</button>
                <button id="show-child-register" class="w-full mt-3 bg-gray-200 text-gray-800 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition duration-300">Soy Hijo</button>
                <p class="mt-6 text-sm text-gray-500">¿Ya tienes cuenta? <a href="#" id="show-login" class="font-semibold text-[var(--brand-color)] hover:underline">Inicia Sesión</a></p>
            </div>
            
            <div id="parent-onboarding-container" class="hidden w-full text-center">
                <div id="onboarding-slide-1" class="onboarding-slide">
                    <div class="bg-indigo-100 p-4 rounded-full mb-6 inline-block">
                       <svg class="w-10 h-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.6-3.751A11.959 11.959 0 0112 2.764h.001z" /></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Conexiones Seguras</h2>
                    <p class="text-gray-500 mt-2">Los amigos solo se pueden añadir en persona, escaneando un código QR único que cambia constantemente.</p>
                </div>
                <div id="onboarding-slide-2" class="onboarding-slide hidden">
                    <div class="bg-indigo-100 p-4 rounded-full mb-6 inline-block">
                        <svg class="w-10 h-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.108 1.204.165.399.505.71.93.78l.893.15c.543.09.94.56.94 1.11v1.093c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.108 1.204l.527.738c.32.447.27.96-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.399.165-.71.505-.781.93l-.15.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.149-.894c-.07-.424-.384-.764-.78-.93-.398-.164-.855-.142-1.205.108l-.737.527a1.125 1.125 0 01-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.399-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.11v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.399-.165.71-.505.78-.93l.15-.893z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Control Total en tus Manos</h2>
                    <p class="text-gray-500 mt-2">Establece límites de tiempo, filtra contenido inapropiado y decide si tu hijo puede añadir amigos.</p>
                </div>
                <div id="onboarding-slide-3" class="onboarding-slide hidden">
                     <div class="bg-indigo-100 p-4 rounded-full mb-6 inline-block">
                        <svg class="w-10 h-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639l4.43-7.563A2 2 0 018.154 3h7.692a2 2 0 011.685.823l4.43 7.563a1.012 1.012 0 010 .639l-4.43 7.563A2 2 0 0115.846 21H8.154a2 2 0 01-1.685-.823l-4.43-7.563z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 12.75a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" /></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Supervisión Constante</h2>
                     <p class="text-gray-500 mt-2">Revisa las conversaciones y la lista de amigos de tus hijos para garantizar su seguridad en todo momento.</p>
                </div>

                <div class="mt-8">
                    <button id="next-onboarding-slide" class="w-full bg-[var(--brand-color)] text-white font-bold py-3 px-4 rounded-xl hover:bg-[var(--brand-color-dark)] transition duration-300 shadow-sm">Siguiente</button>
                    <p class="mt-4 text-sm text-gray-500 text-center"><a href="#" id="onboarding-go-back" class="font-semibold text-[var(--brand-color)] hover:underline">Volver</a></p>
                </div>
            </div>
            <!-- Formularios de registro post-onboarding -->
            <div id="parent-register-container" class="hidden w-full text-left">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Registro para Padres</h2>
                <form id="parent-register-form" class="space-y-4">
                    <input type="text" id="parent-name" placeholder="Nombre completo" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                    <input type="email" id="parent-email" placeholder="Correo electrónico" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                    <input type="password" id="parent-password" placeholder="Contraseña" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                    <button type="submit" class="w-full bg-[var(--brand-color)] text-white font-bold py-3 rounded-lg hover:bg-[var(--brand-color-dark)] transition duration-300">Crear Cuenta</button>
                </form>
                <p class="mt-4 text-sm text-gray-500 text-center"><a href="#" class="go-back font-semibold text-[var(--brand-color)] hover:underline">Volver</a></p>
            </div>
            <div id="child-register-container" class="hidden w-full text-left">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Registro para Hijos</h2>
                <form id="child-register-form" class="space-y-4">
                    <input type="text" id="parent-code" placeholder="Código del Padre" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                    <input type="text" id="child-name" placeholder="Tu nombre" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                    <input type="password" id="child-password" placeholder="Tu contraseña" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                    <button type="submit" class="w-full bg-[var(--brand-color)] text-white font-bold py-3 rounded-lg hover:bg-[var(--brand-color-dark)] transition duration-300">Unirme</button>
                </form>
                <p class="mt-4 text-sm text-gray-500 text-center"><a href="#" class="go-back font-semibold text-[var(--brand-color)] hover:underline">Volver</a></p>
            </div>
        </div>
        
        <div id="login-screen" class="screen flex-1 flex-col p-6 md:p-8 justify-center">
            <h2 class="text-2xl font-bold text-gray-800">Iniciar Sesión</h2>
            <div class="w-full flex border-b mt-6">
                <button id="login-parent-tab" class="flex-1 font-semibold py-2 border-b-2 border-[var(--brand-color)] text-[var(--brand-color)]">Soy Padre</button>
                <button id="login-child-tab" class="flex-1 font-semibold py-2 text-gray-500">Soy Hijo</button>
            </div>
            <form id="login-form-parent" class="mt-6 space-y-4 w-full">
                <input type="email" id="login-email" placeholder="Correo electrónico" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                <input type="password" id="login-password" placeholder="Contraseña" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                <button type="submit" class="w-full bg-[var(--brand-color)] text-white font-bold py-3 rounded-lg hover:bg-[var(--brand-color-dark)] transition duration-300">Entrar</button>
            </form>
            <form id="login-form-child" class="mt-6 space-y-4 w-full hidden">
                <input type="text" id="login-parent-code" placeholder="Código del Padre" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                <input type="text" id="login-child-name" placeholder="Tu nombre" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                <input type="password" id="login-child-password" placeholder="Tu contraseña" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--brand-color)]">
                <button type="submit" class="w-full bg-[var(--brand-color)] text-white font-bold py-3 rounded-lg hover:bg-[var(--brand-color-dark)] transition duration-300">Entrar</button>
            </form>
            <p class="mt-4 text-sm text-gray-500 text-center"><a href="#" id="login-go-back" class="font-semibold text-[var(--brand-color)] hover:underline">Volver</a></p>
        </div>
        
        <!-- Pantalla de Verificación de Correo -->
        <div id="verify-email-screen" class="screen flex-1 flex-col items-center justify-center text-center p-6 md:p-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            <h2 class="text-2xl font-bold text-gray-800">Verifica tu Correo</h2>
            <p class="text-gray-500 mt-2">Hemos enviado un enlace de verificación a <strong id="verification-email-display"></strong>. Por favor, revisa tu bandeja de entrada y spam.</p>
            <button id="check-verification-button" class="mt-8 w-full bg-[var(--brand-color)] text-white font-bold py-3 rounded-lg">Listo, ya lo he verificado</button>
            <button id="resend-verification-email" class="mt-4 w-full bg-gray-200 text-gray-800 font-bold py-3 rounded-lg">Reenviar Correo</button>
            <p class="mt-6 text-sm text-gray-500"><a href="#" id="verification-logout-link" class="font-semibold text-gray-500 hover:underline">Volver al inicio</a></p>
        </div>

        <div id="notification" class="fixed bottom-5 right-5 bg-gray-900 text-white py-2 px-5 rounded-full shadow-lg opacity-0 transform translate-y-3 transition-all duration-300 pointer-events-none z-50">
            <p id="notification-message"></p>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, onSnapshot, orderBy, serverTimestamp, deleteDoc, limit, updateDoc, writeBatch, FieldValue, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyC1XbhA7TTz7gn-3_SFJ53p7DPfq36eRdg",
            authDomain: "safechat-224e2.firebaseapp.com",
            projectId: "safechat-224e2",
            storageBucket: "safechat-224e2.firebasestorage.app",
            messagingSenderId: "390500687585",
            appId: "1:390500687585:web:36fc0ce72b58e02351e1a0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        const showScreen = (screenId) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(screenId).classList.add('active-screen');
        };

        const setVh = () => {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        };
        window.addEventListener('resize', setVh);
        window.addEventListener('load', setVh);
        setVh();
        
        function showNotification(message) {
            const el = document.getElementById('notification'), msgEl = document.getElementById('notification-message');
            msgEl.textContent = message;
            el.classList.remove('opacity-0', 'translate-y-3');
            setTimeout(() => el.classList.add('opacity-0', 'translate-y-3'), 2500);
        }
        
        function resetWelcomeScreen() {
            document.getElementById('parent-register-container').classList.add('hidden');
            document.getElementById('child-register-container').classList.add('hidden');
            document.getElementById('parent-onboarding-container').classList.add('hidden');
            document.getElementById('welcome-main').classList.remove('hidden');
        }

        onAuthStateChanged(auth, async (user) => {
            resetWelcomeScreen();
            if (user) {
                await user.reload();
                const userDocSnap = await getDoc(doc(db, "users", user.uid));
                if (userDocSnap.exists()) {
                    currentUser = user;
                    const userData = userDocSnap.data();
                    if (userData.role === 'parent') {
                        if (!user.emailVerified) {
                            document.getElementById('verification-email-display').textContent = user.email;
                            showScreen('verify-email-screen');
                        } else {
                            window.location.href = 'parental.html';
                        }
                    } else if (userData.role === 'child') {
                        window.location.href = 'chat.html';
                    }
                } else {
                     showNotification("No se pudo encontrar tu perfil de usuario.");
                     await signOut(auth);
                }
            } else {
                currentUser = null;
                showScreen('welcome-screen');
            }
        });
        
        document.getElementById('parent-register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('parent-name').value, email = document.getElementById('parent-email').value, password = document.getElementById('parent-password').value;
            try {
                const cred = await createUserWithEmailAndPassword(auth, email, password);
                const parentCode = `SAFE${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
                await setDoc(doc(db, "users", cred.user.uid), { name, email, role: 'parent', parentCode });
                await sendEmailVerification(cred.user);
                showNotification('Registro exitoso. Revisa tu correo para verificar.');
                document.getElementById('verification-email-display').textContent = email;
                showScreen('verify-email-screen');
            } catch (error) { showNotification(`Error: ${error.message}`); }
        });

        document.getElementById('child-register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const parentCode = document.getElementById('parent-code').value;
            const name = document.getElementById('child-name').value;
            const password = document.getElementById('child-password').value;
            
            try {
                const parentQuery = query(collection(db, "users"), where("parentCode", "==", parentCode), limit(1));
                const parentSnap = await getDocs(parentQuery);
                if (parentSnap.empty) { throw new Error("Código del padre no válido."); }
                const parentId = parentSnap.docs[0].id;

                const childQuery = query(collection(db, "users"), where("parentId", "==", parentId), where("name_lowercase", "==", name.toLowerCase()));
                const childSnap = await getDocs(childQuery);
                if (!childSnap.empty) { throw new Error("Ya existe un usuario con este nombre. Intenta iniciar sesión."); }

                const email = `${name.replace(/\s+/g, '').toLowerCase()}.${Date.now()}@safechat.local`;
                const cred = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, "users", cred.user.uid), {
                    name, email, role: 'child', parentId, name_lowercase: name.toLowerCase(),
                    settings: { 
                        canAddFriends: true, 
                        timeLimits: { enabled: false, startTime: '08:00', endTime: '22:00' },
                        sessionTime: { enabled: false, duration: 30, unit: 'minutes'},
                        filters: { textLevel: 'medium' }
                    }
                });
            } catch (error) { showNotification(`Error: ${error.message}`); }
        });

        document.getElementById('login-form-parent').addEventListener('submit', (e) => {
            e.preventDefault();
            signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value).catch(err => showNotification(`Error: ${err.message}`));
        });

        document.getElementById('login-form-child').addEventListener('submit', async (e) => {
            e.preventDefault();
            const parentCode = document.getElementById('login-parent-code').value, childName = document.getElementById('login-child-name').value, password = document.getElementById('login-child-password').value;
            try {
                const pQuery = query(collection(db, "users"), where("parentCode", "==", parentCode), limit(1));
                const pSnap = await getDocs(pQuery);
                if (pSnap.empty) throw new Error("Código del padre inválido.");
                const cQuery = query(collection(db, "users"), where("parentId", "==", pSnap.docs[0].id), where("name_lowercase", "==", childName.toLowerCase()), limit(1));
                const cSnap = await getDocs(cQuery);
                if (cSnap.empty) throw new Error("Datos de hijo incorrectos.");
                await signInWithEmailAndPassword(auth, cSnap.docs[0].data().email, password);
            } catch (error) { 
                showNotification(`Error: ${error.message}`); 
            }
        });
        
        document.getElementById('verification-logout-link').addEventListener('click', async (e) => {
            e.preventDefault();
            await signOut(auth);
        });
        
        document.getElementById('resend-verification-email').addEventListener('click', async () => {
            if (auth.currentUser) {
                try {
                    await sendEmailVerification(auth.currentUser);
                    showNotification('Correo de verificación reenviado.');
                } catch (error) { showNotification(`Error: ${error.message}`); }
            }
        });

        document.getElementById('check-verification-button').addEventListener('click', async () => {
            if (auth.currentUser) {
                await auth.currentUser.reload();
                if (auth.currentUser.emailVerified) {
                    showNotification("¡Correo verificado con éxito!");
                    window.location.href = 'parental.html';
                } else {
                    showNotification("Aún no has verificado tu correo. Revisa tu bandeja de entrada.");
                }
            }
        });

        document.getElementById('show-login').onclick = () => showScreen('login-screen');
        document.getElementById('show-parent-onboarding').addEventListener('click', () => {
            document.getElementById('welcome-main').classList.add('hidden');
            document.getElementById('parent-onboarding-container').classList.remove('hidden');
        });
        document.getElementById('show-child-register').addEventListener('click', () => {
            document.getElementById('welcome-main').classList.add('hidden');
            document.getElementById('child-register-container').classList.remove('hidden');
        });
        document.querySelectorAll('.go-back').forEach(btn => btn.addEventListener('click', (e) => { e.preventDefault(); resetWelcomeScreen(); }));
        document.getElementById('login-go-back').addEventListener('click', (e) => { e.preventDefault(); showScreen('welcome-screen'); });
        
        const loginParentTab = document.getElementById('login-parent-tab'), loginChildTab = document.getElementById('login-child-tab');
        const loginFormParent = document.getElementById('login-form-parent'), loginFormChild = document.getElementById('login-form-child');
        loginParentTab.onclick = () => {
            loginParentTab.classList.add('border-[var(--brand-color)]', 'text-[var(--brand-color)]');
            loginChildTab.classList.remove('border-[var(--brand-color)]', 'text-[var(--brand-color)]');
            loginFormParent.classList.remove('hidden');
            loginFormChild.classList.add('hidden');
        };
        loginChildTab.onclick = () => {
            loginChildTab.classList.add('border-[var(--brand-color)]', 'text-[var(--brand-color)]');
            loginParentTab.classList.remove('border-[var(--brand-color)]', 'text-[var(--brand-color)]');
            loginFormChild.classList.remove('hidden');
            loginFormParent.classList.add('hidden');
        };

        const onboardingSlides = document.querySelectorAll('.onboarding-slide');
        const nextOnboardingBtn = document.getElementById('next-onboarding-slide');
        let currentOnboardingSlide = 0;

        function updateOnboardingView() {
            onboardingSlides.forEach((slide, index) => slide.classList.toggle('hidden', index !== currentOnboardingSlide));
            nextOnboardingBtn.textContent = (currentOnboardingSlide === onboardingSlides.length - 1) ? 'Empezar' : 'Siguiente';
        }
        
        nextOnboardingBtn.addEventListener('click', () => {
            if (currentOnboardingSlide < onboardingSlides.length - 1) {
                currentOnboardingSlide++;
                updateOnboardingView();
            } else {
                document.getElementById('parent-onboarding-container').classList.add('hidden');
                document.getElementById('parent-register-container').classList.remove('hidden');
            }
        });

        document.getElementById('onboarding-go-back').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('parent-onboarding-container').classList.add('hidden');
            document.getElementById('welcome-main').classList.remove('hidden');
        });
    </script>
</body>
</html>
